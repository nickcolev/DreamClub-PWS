<html><head><title>APWS</title>
<meta http-equiv="Content-Type" content="text/html; charset=windows-1251"/>
<meta name="viewport" content="width=device-width, initial-scale=1.2"/>
<link href="/nick.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="/usrlib.js"></script>
</head>
<body>

<p class="tmenu"><a href="./">APWS</a> <span class="fa fa-caret-right"></span> Development</p>

<h1>APWS Development<br/><fn>based on <a href="https://twitter.com/bodeme">bodeme</a> <a href="https://github.com/bodeme/androidwebserver">androidwebserver</a></fn></h1>

<p class="note"><a href="https://developer.chrome.com/devtools/docs/remote-debugging">Remote Debugging with Chrome</a></p>

<ul>
 <li><a href="#ov">Overview</a></li>
 <li><a href="#test">Test</a></li>
 <li><a href="#todo">To do</a></li>
 <li><a href="#ico">Icon</a></li>
 <li><a href="#bug">Bugs</a></li>
 <li><a href="#les">Lessons</a></li>
</ul>

<h3 class="ul" id="ov">Overview</h3>
<ul>
 <li><tt>StartActivity</tt><br/>Starts and bind to the service. If service not already started &mdash; start it.</li>
 <li><tt>ServerService</tt><br/>Handle the binding requests, notifications, and <tt>onStartCommand</tt>.</li>
 <li><tt>ServerHandler</tt><br/>Serve client requests (HTTP implementation)</li>
</ul>

<h3 class="ul" id="test">Test</h3>
<ul>
 <li><a href="form.htm">POST via form</a> <small>(no upload on stock Android 2.1 browser)</small></li>
 <li><a href="test.htm">GET/POST/PUT via JavaScript</a></li>
 <li><a href="put.php">PUT via PHP</a></li>
</ul>
<p>Manual</p>
<pre class="cp">printf "TRACE / HTTP/1.1\r\n\r\n" | <a href="http://nc110.sourceforge.net/">nc</a> 192.168.1.12 8080</pre>
<form>
<p>Use Case
<table>
 <tr><td rowspan=2>&nbsp;</td><th colspan=2>index.html</th></tr>
 <tr><th width=60>Exists</th><th>Not exists</th></tr>
 <tr><td><tt>GET /</tt></td><td align="center"><input type="checkbox"/></td><td align="center"><input type="checkbox"/></td></tr>
 <tr><td><tt>GET /tmp</tt></td><td align="center"><input type="checkbox"/></td><td align="center"><input type="checkbox"/></td></tr>
 <tr><td><tt>GET /tmp/</tt></td><td align="center"><input type="checkbox"/></td><td align="center"><input type="checkbox"/></td></tr>
 <tr><td><tt>GET /tmp/test.htm</tt></td><td colspan=2>&nbsp;</td></tr>
 <tr><td><tt>GET /briefs.html</tt></td><td class="note" colspan=2><i>many internal GETs</i></td></tr>
</table>
</form>
</p>
<p class="note">Test other methods functionality.</p>

<h3 class="ul" id="todo">To do</h3>
<ul>
 <li>Art work &mdash; new icons</li>
 <li>Implement <a href="http://developer.android.com/reference/android/net/wifi/WifiManager.WifiLock.html">WiFi lock</a> <small>(when only httpd runs, WiFi goes to sleep)</small></li>
 <li>Implement start on boot of the service</li>
 <li>PUT/POST implementation</li>
 <li>When WiFi goes off &mdash; restart at localhost. When goes on &mdash; restart at the IP.</li>
</ul>

<h3 class="ul" id="ico">Icon</h3>
<ul>
 <li><a href="/~vera-5/logo.htm">Vera5 logo</a> <small>(Best for branding. Though, looks hollow and user won't associate it with a web server.)</small></li>
 <li>ant <small>(As it is black, hard to be seen with transparency.)</small></li>
 <li>butterfly <small>('but2.png' looks good, 'dragonart.png' as well, but a butterfly is a symbol of what?)</small></li>
 <li>clover</li>
 <li>globe <small>(best choice as it is associated with web folder/site; used OS X Maverick 10)</small></li>
 <li>leaf(-ves)</li>
</ul>
<p class="note">Current version based on <a href="http://www.macgasm.net/2013/10/31/os-x-10-9-mavericks-server-review/">OS X 10.9 Mavericks Server</a>. Processed via Gimp to 64x64 96dpi. Squeezed to 24x24 for the notification. Good candidates are <a href="http://www.nasa.gov/externalflash/earthday_gallery/hi-resjpgs/4.jpg">this</a> and <a href="http://www.nasa.gov/sites/default/files/s1431aw_0.jpg">this</a> NASA images. Take a look at <a href="http://photography.nationalgeographic.com/photography/">National Georgaphic photos</a>.</p>

<h3 class="ul" id="bug">Bugs</h3>
<ul>
 <li><del>On Settings open, summary is displayed from the xml. Should be set from actual values set by the user.</del></li>
 <li><del>[Back] goes to prev. screen, and the prev. log can be seen. The log view seems to be recreated on [Home] and next [Restore]. Something's wrong.</del></li>
 <li><del><tt>some.htm?a=b</tt> fails <small>(question mark)</small></del></li>
 <li><del><tt><q>A B C.htm</q></tt> fails <small>(space in the name)</small></del></li>
</ul>

<p class="note">While testing, saw access from 59.31.246.215 (South Korea), 60.173.26.206 (China) &mdash; see <a href="http://www.ipligence.com/geolocation">IP geolocation</a>.</p>

<h3 id="les">Lessons learned</h3>
<div class="m3em">
<p><b>Activity persistence</b><br/>
In <tt>AndroidManifest.xml</tt> add to the main activity</p>
<pre class="cp">android:launchMode="singleTop"</pre>
<p>and implement</p>
<pre class="cp">@Override
<b>public void</b> onBackPressed() {
    moveTaskToBack(true);
}</pre>

<p><b>APK name</b><br/>
it <tt>build.xml</tt></p>
<pre class="cp">&lt;<b>project</b> <var>name</var>="aws" ...</pre>

<p><b>Java Buffer <q>bug</q></b><br/>
If an input/output stream is wrapped in <tt>Buffered</tt>-something &mdash; the bytes are decoded <small>(depending of the stream's character set/encoding)</small>, which skew binary input/output. Found this while wondering while working on the <tt>PUT</tt> method implementation.</p>

<p><b><a class="kw" href="http://developer.android.com/reference/java/lang/Runtime.html#exec(java.lang.String, java.lang.String[])">Runtime.exec</a> <q>envp</q> issue</b></p>
<pre class="cp"><del>Runtime.getRuntime().exec(&quot;sh <i>cmd</i> ...)</del>
Runtime.getRuntime().exec(&quot;/system/bin/sh <i>cmd</i> ...)</pre>

<p><b>Java does NOT support multiple inheritance</b><br/>
Even <a href="http://docs.oracle.com/javase/tutorial/java/IandI/multipleinheritance.html">they say so</a>, one can't do</p>
<pre class="cp"><b>class</b> <var>SomeClass</var> <b>extends</b> <var>Class1</var> <b>extends</b> <var>Class2</var></pre>

<p><b>Measure method run time</b> <a class="fa fa-external-link" href="http://stackoverflow.com/questions/3382954/measure-execution-time-for-a-java-method" title="src"></a></p>
<pre class="cp"><b>long</b> <var>begin</var> = System.currentTimeMillis();
<i class="comment">// Do something</i>
System.out.println(System.currentTimeMillis() - <var>begin</var>);</pre>

</div>

</body></html>
